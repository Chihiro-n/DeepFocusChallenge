# Deep Focus Challenge — EXP000 ベースライン

SEM画像のデフォーカス量（abs_focus）を回帰するコンペのために、画像を表形式の特徴量に変換して予測するシンプルなベースライン（EXP000）を整理します。深層モデルは使わず、物理的に意味のあるボケ指標だけで構成しています。

## 何をやったか（EXP000）
- **画像→特徴量→回帰**: 画像を読み込み、ボケに敏感な指標を3つ抽出してRidge回帰で予測。
- **特徴量（3本）**
  - `local_contrast_std`: 局所コントラストのばらつき。ボケると標準偏差が減少。
  - `fft_mid_ratio`: FFT中周波エネルギー比。高周波が落ちると中周波も相対的に低下。
  - `sobel_max`: 勾配の最大値。エッジがぼやけるとピークが下がる。
- **成績**: CV RMSE 20.46 / LB 30.05（ベースラインとしての位置づけ）。

## なぜ効いたか
- **パターン内で一貫する指標に絞った**: 撮像条件が異なると相関が崩れる特徴が多いため、各パターン内で常に「ボケが強いほど値が下がる」特徴だけを残した。
- **物理的に解釈可能な高周波指標**: 勾配・周波数系は輝度変動に比較的強く、ドメインシフトが大きくても破綻しにくい。
- **少数特徴で過学習を抑制**: サンプル55枚に対し3特徴量に絞り、汎化性能を確保。

## 使い方
```bash
# 推論（特徴抽出 + Ridge回帰）
python EXP/EXP000/infer.py

# 特徴量の挙動を可視化したいとき
python EXP/EXP000/test_blur_features.py --image_path input/DeepFocusChallenge_v2/sample/020000.JPG
```

## データ前提
- `input/DeepFocusChallenge_v2/` に `sample/`・`test/` の画像と `sample.csv`・`test.csv` があること。
- テスト画像は1枚ずつ独立して特徴抽出し、他のテスト画像の情報を使わない（集約・クラスタリング禁止）。

## 知見メモ
- 全体相関が高くてもパターン別では無効な特徴が多い。必ずパターン内の一貫性をチェックする。
- 3本だけでもボケ方向と符号がそろった特徴を選ぶことでベースラインとして機能する。より高度なモデルを試す前に有用なスタートポイントになる。
